<h1 id="react-query-기본-설정">React-Query 기본 설정</h1>

<p>React Query는 클라이언트에서 ‘서버 상태’를 관리하기 위한 라이브러리다.<br />
React 환경에서 기존 Redux와 같은 상태 관리 라이브러리는 클라이언트 데이터의 상태 관리를 위한 라이브러리이기 때문에, 서버에서의 데이터 상태가 쉽게 outdate 되는 등의 문제가 발생한다.<br />
이를 방지하기 위해 간결한 코드와 지속적으로 서버 데이터를 업데이트하는 기능을 제공해주는 게 React Query다.</p>

<h2 id="react-query의-설치-및-초기-설정">React Query의 설치 및 초기 설정</h2>

<h3 id="설치">설치</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm i @tanstack/react-query@beta <span class="c"># npm</span>
yarn add @tanstack/react-query@beta <span class="c"># yarn</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">EsLint Plugin Query</code>를 설치하는 명령어는 아래와 같다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm i <span class="nt">-D</span> @tanstack/eslint-plugin-query@beta <span class="c"># npm</span>
yarn add <span class="nt">-D</span> @tanstack/eslint-plugin-query@beta <span class="c"># yarn</span>
</code></pre></div></div>

<p>ESLink 플러그인으로 설치하였을 경우 플러그인 폴더??에 있는 .eslintrc 파일에 아래를 추가한다</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"plugins"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"@tanstack/query"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"@tanstack/query/exhaustive-deps"</span><span class="p">:</span><span class="w"> </span><span class="s2">"error"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">규칙</span><span class="w"> </span><span class="err">추가하기</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"extends"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"plugin:@tanstack/eslint-plugin-query/recommended"</span><span class="p">]</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">모든</span><span class="w"> </span><span class="err">권장</span><span class="w"> </span><span class="err">규칙</span><span class="w"> </span><span class="err">활성화하기</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="react-query-devtools의-설치-및-활용-방법">React Query Devtools의 설치 및 활용 방법</h2>

<h3 id="설치-1">설치</h3>

<p>아래 패키지를 설치하면 된다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm i @tanstack/react-query-devtools <span class="c"># npm</span>
<span class="nv">$ </span>yarn add @tanstack/react-query-devtools <span class="c"># yarn</span>
</code></pre></div></div>

<h3 id="사용-방법">사용 방법</h3>

<p>DevTools로 최상위 앱 컴포넌트를 감싸준다. (페이지의 루트에 가까울 수록 작동이 잘 된다.)<br />
이렇게 감싸주면 앱 화면에서 토글 버튼으로 개발자 도구를 열어서 사용할 수 있다.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">ReactQueryDevtools</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@tanstack/react-query-devtools</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">App</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return </span><span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">QueryClientProvider</span> <span class="nx">client</span><span class="o">=</span><span class="p">{</span><span class="nx">queryClient</span><span class="p">}</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">MyApp</span> <span class="o">/&gt;</span>
            <span class="o">&lt;</span><span class="nx">ReactQueryDevtools</span> <span class="nx">initialIsOpen</span><span class="o">=</span><span class="p">{</span><span class="kc">false</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/QueryClientProvider</span><span class="err">&gt;
</span>    <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>설정 속성들에 대한 설명이다.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">initialIsOpen</code> : true이면 열린 상태로 시작</li>
  <li>
    <table>
      <tbody>
        <tr>
          <td><code class="language-plaintext highlighter-rouge">buttonPosition</code> : 토글 버튼이 뜨는 위치. <code class="language-plaintext highlighter-rouge">"top-left"</code>(기본값)</td>
          <td><code class="language-plaintext highlighter-rouge">"top-right"</code></td>
          <td><code class="language-plaintext highlighter-rouge">"bottom-left"</code></td>
          <td><code class="language-plaintext highlighter-rouge">"bottom-right"</code></td>
        </tr>
      </tbody>
    </table>
  </li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">buttonPosition</span><span class="p">?:</span> <span class="dl">"</span><span class="s2">top-left</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">top-right</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">bottom-left</span><span class="dl">"</span> <span class="o">|</span> <span class="dl">"</span><span class="s2">bottom-right</span><span class="dl">"</span><span class="nx">awww</span>
</code></pre></div></div>

<ul>
  <li>
    <table>
      <tbody>
        <tr>
          <td><code class="language-plaintext highlighter-rouge">position</code> : devTools 패널이 뜨는 위치. <code class="language-plaintext highlighter-rouge">"top"</code></td>
          <td><code class="language-plaintext highlighter-rouge">"bottom"</code>(기본값)</td>
          <td><code class="language-plaintext highlighter-rouge">"left"</code></td>
          <td><code class="language-plaintext highlighter-rouge">"right"</code></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li><code class="language-plaintext highlighter-rouge">client</code>: 어떤 QueryClient를 개발자 도구에서 사용할 것인지</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">errorTypes</span><span class="p">?:</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span> <span class="nl">initializer</span><span class="p">:</span> <span class="p">(</span><span class="na">query</span><span class="p">:</span> <span class="nx">Query</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">TError</span><span class="p">}</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">errorTypes</code> : 쿼리에서 트리거되는 오류들을 정의해두고, 오류가 발생하면 initializer가 호출된다.</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">errorTypes</span><span class="p">?:</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span> <span class="nl">initializer</span><span class="p">:</span> <span class="p">(</span><span class="na">query</span><span class="p">:</span> <span class="nx">Query</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">TError</span><span class="p">}</span>
</code></pre></div></div>

<h2 id="react-query의-주요-옵션들에-대한-이해">React Query의 주요 옵션들에 대한 이해</h2>

<h2 id="react-query의-전반적인-아키텍처와-데이터-흐름에-대한-이해">React Query의 전반적인 아키텍처와 데이터 흐름에 대한 이해</h2>

<p><img src="https://raw.githubusercontent.com/makepin2r/makepin2r.github.io/main/images/23-07-30-react-query-architecture.PNG" alt="React Query Architecture" /></p>

<p>https://dreamcode.tistory.com/440<br />
https://sanoo.dev/react-query</p>
